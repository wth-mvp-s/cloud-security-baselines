003.A-CPL-KV--Art.5_Art.32.md
This artefact proves alignment with **data-resilience** and **security-of-processing** obligations.


Even though Microsoft’s built-in policies definitions exist (e.g.: “Key vaults should have soft delete enabled”),
none of them validate `softDeleteRetentionInDays` for a specific period such as 90 days.

AUDIT KV PROPERTIES:
- soft delete enabled,
- purge protection enabled,
- retention == 90 days.

WHY:
Built-in definitions verify purge and soft delete, but none validate the exact softDeleteRetentionInDays = 90.
Risk: permanent loss of recoverable secrets during audit or breach investigation.
this custom policy audit for deleted secrets remain recoverable during audit or breach investigation.

RGPD Art:
Article 32 – Security of processing
Article 5(1)(e) – Storage limitation (personal data shall be kept no longer than necessary but long enough for accountability)


# tdd
az keyvault list --query "[].{name:name,rg:resourceGroup}" -o tsv |
ForEach-Object {
$p = $_ -split "`t"
$o = az keyvault show -n $p[0] -g $p[1] -o json | ConvertFrom-Json
$ret = $o.properties.softDeleteRetentionInDays; if ($null -eq $ret) {$ret = 0}
[pscustomobject]@{
Name=$o.name; SoftDelete=[bool]$o.properties.enableSoftDelete
PurgeProtection=[bool]$o.properties.enablePurgeProtection
RetentionDays=[int]$ret
Compliant=($o.properties.enableSoftDelete -and $o.properties.enablePurgeProtection -and $ret -eq 90)
}
} | Sort-Object Compliant, Name | Format-Table -AutoSize